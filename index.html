<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>A-Frame Gaze Interaction Fixed</title>
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script>
  AFRAME.registerComponent('rounded-plane', {
    schema: {
      width: {type: 'number', default: 2.5},
      height: {type: 'number', default: 0.8},
      radius: {type: 'number', default: 0.1},
      color: {type: 'color', default: '#FFFFFF'},
      opacity: {type: 'number', default: 0.9}
    },
    init: function () {
      const data = this.data;
      const el = this.el;

      // Create canvas
      const canvas = document.createElement('canvas');
      canvas.width = 512;
      canvas.height = 256;
      const ctx = canvas.getContext('2d');

      // Calculate corner radius in pixels
      const r = data.radius * canvas.height;

      // Draw rounded rectangle with opacity
      const [rVal, gVal, bVal] = this.hexToRgb(data.color);
      ctx.fillStyle = `rgba(${rVal}, ${gVal}, ${bVal}, ${data.opacity})`;

      ctx.beginPath();
      ctx.moveTo(r, 0);
      ctx.lineTo(canvas.width - r, 0);
      ctx.quadraticCurveTo(canvas.width, 0, canvas.width, r);
      ctx.lineTo(canvas.width, canvas.height - r);
      ctx.quadraticCurveTo(canvas.width, canvas.height, canvas.width - r, canvas.height);
      ctx.lineTo(r, canvas.height);
      ctx.quadraticCurveTo(0, canvas.height, 0, canvas.height - r);
      ctx.lineTo(0, r);
      ctx.quadraticCurveTo(0, 0, r, 0);
      ctx.closePath();
      ctx.fill();

      // Create texture
      const texture = new THREE.CanvasTexture(canvas);
      const material = new THREE.MeshBasicMaterial({map: texture, transparent: true});
      const geometry = new THREE.PlaneGeometry(data.width, data.height);
      const mesh = new THREE.Mesh(geometry, material);

      el.setObject3D('mesh', mesh);
    },

    // Utility: Convert hex to RGB
    hexToRgb(hex) {
      const stripped = hex.replace('#', '');
      const bigint = parseInt(stripped, 16);
      const r = (bigint >> 16) & 255;
      const g = (bigint >> 8) & 255;
      const b = bigint & 255;
      return [r, g, b];
    }
  });
</script>

  </head>
  <body>    
    version 0.0.3
    <a-scene>
      <!-- Assets -->
      <a-assets>
        <audio id="ding-sound" src="https://cdn.aframe.io/basic-guide/audio/backgroundnoise.wav"></audio>
      </a-assets>

      <!-- Skybox (360Â° image) -->
      <a-sky src="img/CieloHD2.jpg" rotation="0 -130 0"></a-sky>


      <!-- Interactive Box -->
      <a-box id="box"
             position="0 1.5 -3"
             color="#4CC3D9"
             sound="on: click; src: #ding-sound"
             animation__scale="property: scale; startEvents: click; to: 1.2 1.2 1.2; dur: 200; dir: alternate"
             animation__rotate="property: rotation; startEvents: click; to: 0 360 0; dur: 1000; easing: easeOutQuad">
      </a-box>

      <!-- White Rounded Rectangle with Black Text -->
<a-entity position="0 2.5 -3" look-at="[camera]">
  <a-entity rounded-plane="width: 2.5; height: 0.8; radius: 0.1; color: #FFFFFF; opacity: 0.9"></a-entity>

  <!-- Centered black text -->
  <a-text 
    value="This is an immersive experience"
    align="center"
    color="#000000"
    width="2.2"
    position="0 0 0.01">
  </a-text>
</a-entity>



      <!-- Camera + Gaze Cursor -->
      <a-entity camera look-controls wasd-controls position="0 1.6 0">
        <a-entity 
          cursor="fuse: true; fuseTimeout: 1000"
          raycaster="objects: #box"
          position="0 0 -1"
          geometry="primitive: ring; radiusInner: 0.02; radiusOuter: 0.03"
          material="color: black; shader: flat">
        </a-entity>
      </a-entity>
    </a-scene>

    <script>
      // Handle color change on gaze click
      const box = document.querySelector('#box');
      box.addEventListener('click', () => {
        box.setAttribute('color', '#FFC107'); // highlight color
        setTimeout(() => {
          box.setAttribute('color', '#4CC3D9'); // reset to original
        }, 1000); // delay in ms
      });
    </script>
  </body>
</html>
